!function(t){"use strict";function a(t,a){return function(e,r){var n=e.map(function(a,e){return a.key==t?e:void 0}).filter(isFinite),c=r.map(function(a,e){return a.key==t?e:void 0}).filter(isFinite);return"asc"===a?e[n].value>r[c].value:e[n].value<r[c].value}}function e(t){switch(t.config.format){case"text":return t.value;case"number":return d3.format(",0f")(t.value);case"percent":return d3.format(".2%")(t.value);case"currency":return d3.format("$.2f")(t.value);default:return t.value}}function r(t){for(var a=d3.select(t),e=d3.values(d3.rgb(a.style("background-color"))).slice(0,3),r=0;r<e.length;++r)e[r]=e[r]/255,e[r]<=.03928?e[r]=e[r]/12.92:e[r]=Math.pow((e[r]+.055)/1.055,2.4);var n=.2126*e[0]+.7152*e[1]+.0722*e[2];return n>.5?"black":"white"}function n(t){t=t||{},this.bindto="bindto"in t?t.bindto:"#d3c-table",this.selectTable=d3.select(this.bindto).append("table"),this.selectTable.append("thead").append("tr"),this.selectTable.append("tbody"),this.data("data"in t?t.data:[]),this.columns("columns"in t?t.columns:[])}function c(t){t.each(function(t,a){var n=d3.select(this);if("chart"===t.config.type){var c=t.config.chart.x,i=(t.config.chart.color,t.config.chart.width);n.select("svg").remove();var o=n.append("svg").attr({width:i,height:20});o.append("rect").attr("class",function(t){return"bar bar--"+(t.value<0?"negative":"positive")}).attr("x",function(t){return c(t.config.chart.zeroBased?0:Math.min(0,t.value))}).attr("y",0).attr("rx",3).attr("ry",3).attr("width",function(t){return t.config.chart.zeroBased?Math.abs(c(t.value)):Math.abs(c(t.value)-c(0))}).attr("height",20).attr("fill",function(t){return t.color}),o.append("text").text(function(t){return e(t)}).attr("y",15).attr("x",function(t){var a=t.config.chart.zeroBased?Math.abs(c(t.value)):c(t.value);return t.config.chart.zeroBased?a>i/2?c(0)+Math.abs(c(0))+8:c(0)+Math.abs(c(t.value)-c(0))+5:a<c(0)?a<c(0)/2?a+5:a-40:a>c(0)+(i-c(0))/2?c(0)+Math.abs(c(t.value)-c(0))-40:c(0)+Math.abs(c(t.value)-c(0))}).attr("class",function(t,a){var e=c(t.value);return e<c(0)?e<c(0)/2?"d3c-chart-label-neg-high":"d3c-chart-label-neg-low":e>c(0)+(i-c(0))/2?"d3c-chart-label-pos-high":"d3c-chart-label-pos-low"})}else if("highlight"===t.config.type){n.select("div").remove();var l=t.config.chart.color;n.append("div").style("background-color",function(t){return l(t.value)}).style("text-align","center").text(function(t){return e(t)}).style("color",function(t){return r(this)})}else n.text(function(t){return e(t)})})}var i={version:"0.0.1"};n.prototype.data=function(t){if(0===arguments.length)return this._data||[];this._data=this._data||[];var a=this;t.forEach(function(t){a.addRow(t)}),this.redraw()},n.prototype.addRow=function(t){var a=[];for(var e in t)t.hasOwnProperty(e)&&a.push({key:e,value:t[e]});this._data.push(a),this.redraw()},n.prototype.columns=function(t){return 0===arguments.length?this._columns||[]:(t||(t={}),this._columns=t,void this.redraw())},n.prototype.recalculate=function(){var t=this.columns(),a=this.data(),e="undefined"==typeof this.selectTable.node()?100:this.selectTable.node().getBoundingClientRect().width;t.length>0&&a.length>0&&(t.forEach(function(t,r){if("chart"===t.type||"highlight"===t.type){t.chart=t.chart||{},t.chart.values=[],a.forEach(function(a){a.forEach(function(a){a.key===t.key&&t.chart.values.push(a.value)})}),console.debug(t.chart.values);var n=parseFloat(t.width)/100;t.chart=t.chart||{},t.chart.zeroBased=t.chart.zeroBased||!1,t.chart.width=Math.floor(e*n),t.chart.x=d3.scale.linear().range([0,t.chart.width]),t.chart.maxX=d3.max(t.chart.values,function(t){return t}),console.debug(t.chart.maxX),t.chart.minX=d3.min(t.chart.values,function(t){return t}),t.chart.minX=t.chart.minX===t.chart.maxX?0:t.chart.minX,t.chart.maxX=Math.abs(t.chart.maxX)>Math.abs(t.chart.minX)?t.chart.maxX:Math.abs(t.chart.minX),t.chart.minX=Math.abs(t.chart.minX)>Math.abs(t.chart.maxX)?t.chart.minX:-1*t.chart.maxX,t.chart.colors=["#f05336","#faa224","#ffd73e","#c6e3bb","#a3d393","#64bc52"],t.chart.color=d3.scale.quantize().domain([t.chart.minX,0,t.chart.maxX]).range(t.chart.colors),t.chart.minX=t.chart.minX>=0?0:t.chart.minX,t.chart.x.domain([t.chart.zeroBased?0:t.chart.minX,t.chart.maxX]).nice()}}),a.forEach(function(a,e){a.forEach(function(e,r){var n=$.grep(t,function(t){return t.key===e.key});if(e.config=n[0]||{},e.config.match=!$.isEmptyObject(n[0]),"chart"in e.config&&(e.x=e.config.chart.x(e.value)||0,e.color=e.config.chart.color(e.value)||"#000","colorFrom"in e.config.chart)){var c=$.grep(a,function(t){return t.key===e.config.chart.colorFrom});e.color=c[0].color||e.color}})}))},n.prototype.sortData=function(t,e){var r=this.data();r.sort(a(t,e)),this.redraw()},n.prototype.redrawHeader=function(){var t=this.columns(),a=this.selectTable.select("thead").selectAll("tr"),e=a.selectAll("th").data(t);e.enter().append("th").style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),e.text(function(t){return t.title}),e.exit().transition().delay(200).duration(500).style("opacity",0).remove();var r=a.selectAll("th").data(t);r.enter().append("th").style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),r.text(function(t){return t.title}),this.recalculate()},n.prototype.redrawRows=function(){var t=this.data();if(t.length>0){var a=this.selectTable.select("tbody").selectAll("tr").data(t),e=a.selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});e.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),e.call(c),e.exit().transition().delay(200).duration(500).style("opacity",0).remove();var r=a.enter().append("tr").selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});r.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),r.call(c),a.exit().transition().delay(200).duration(500).style("opacity",0).remove()}},n.prototype.redraw=function(){var t=this.columns(),a=this.data();t.length>0&&a.length>0&&(this.recalculate(),this.redrawHeader(),this.redrawRows())},i.table=function(t){return new n(t)},"function"==typeof define&&define.amd?define("d3c",["d3"],function(){return i}):"undefined"!=typeof exports&&"undefined"!=typeof module?module.exports=i:t.d3c=i}(window);