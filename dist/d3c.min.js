!function(t){"use strict";function e(t){t=t||{},this.bindto="bindto"in t?t.bindto:"#d3c-table",this.columns("columns"in t?t.columns:[]),this.data="data"in t?t.data:[],this.selectTable=d3.select(this.bindto).append("table"),this.selectTable.append("thead").append("tr"),this.selectTable.append("tbody")}function a(t){t.each(function(t,e){var a=d3.select(this);if("chart"===t.config.type){var n=t.config.chart.x,c=t.config.chart.color,o=t.config.chart.width;a.select("svg").remove();var l=a.append("svg").attr({width:o,height:20});l.append("rect").attr("class",function(t){return"bar bar--"+(t.value<0?"negative":"positive")}).attr("x",function(t){return n(t.config.chart.zeroBased?0:Math.min(0,t.value))}).attr("y",0).attr("rx",3).attr("ry",3).attr("width",function(t){return t.config.chart.zeroBased?Math.abs(n(t.value)):Math.abs(n(t.value)-n(0))}).attr("height",20).attr("fill",function(t){return c(t.value)}),l.append("text").text(function(t){return r(t)}).attr("y",15).attr("x",function(t){var e=t.config.chart.zeroBased?Math.abs(n(t.value)):n(t.value);return t.config.chart.zeroBased?e>o/2?n(0)+Math.abs(n(0))+8:n(0)+Math.abs(n(t.value)-n(0))+5:e<n(0)?e<n(0)/2?e+5:e-40:e>n(0)+(o-n(0))/2?n(0)+Math.abs(n(t.value)-n(0))-40:n(0)+Math.abs(n(t.value)-n(0))}).attr("class",function(t,e){var a=n(t.value);return a<n(0)?a<n(0)/2?"d3c-chart-label-neg-high":"d3c-chart-label-neg-low":a>n(0)+(o-n(0))/2?"d3c-chart-label-pos-high":"d3c-chart-label-pos-low"})}else if("highlight"===t.config.type){a.select("div").remove();var u=t.config.chart.color;a.append("div").style("background-color",function(t){return u(t.value)}).style("text-align","center").text(function(t){return r(t)}).style("color",function(t){return i(this)})}else a.text(function(t){return r(t)})})}function n(t,e){return function(a,n){var r=a.map(function(e,a){return e.key==t?a:void 0}).filter(isFinite),i=n.map(function(e,a){return e.key==t?a:void 0}).filter(isFinite);return"asc"===e?a[r].value>n[i].value:a[r].value<n[i].value}}function r(t){switch(t.config.format){case"text":return t.value;case"number":return d3.format(",0f")(t.value);case"percent":return d3.format(".2%")(t.value);case"currency":return d3.format("$.2f")(t.value);default:return t.value}}function i(t){for(var e=d3.select(t),a=d3.values(d3.rgb(e.style("background-color"))).slice(0,3),n=0;n<a.length;++n)a[n]=a[n]/255,a[n]<=.03928?a[n]=a[n]/12.92:a[n]=Math.pow((a[n]+.055)/1.055,2.4);var r=.2126*a[0]+.7152*a[1]+.0722*a[2];return r>.5?"black":"white"}var c={version:"0.0.1"};e.prototype.addRow=function(t){var e=[];for(var a in t)e.push({key:a,value:t[a]});t=this.bindColumnConfig(e),this.data.push(t),this.redraw()},e.prototype.columns=function(t){if(0===arguments.length)return this._columns;t||(t={}),this._columns=t;var e=this.data||[];if(0===e.length)return this._columns;for(var a=0;a<e.length;a++)e[a]=this.bindColumnConfig(e[a]);this.data=e,this.redraw()},e.prototype.bindColumnConfig=function(t){var e=this.columns();return t.forEach(function(t){var a=$.grep(e,function(e){return e.key===t.key});t.config=a[0]||{},t.config.match=!$.isEmptyObject(a[0])}),t},e.prototype.updateColumnStats=function(){var t=this.columns(),e=this.data,a=this.selectTable.node().getBoundingClientRect().width;t.forEach(function(t){if("chart"===t.type||"highlight"===t.type){var n=[];e.forEach(function(e){e.forEach(function(e){e.key===t.key&&n.push(e.value)})});var r=parseFloat(t.width)/100;t.chart=t.chart||{},t.chart.zeroBased=t.chart.zeroBased||!1,t.chart.width=Math.floor(a*r),t.chart.x=d3.scale.linear().range([0,t.chart.width]),t.chart.maxX=d3.max(n,function(t){return t}),t.chart.minX=d3.min(n,function(t){return t}),t.chart.minX=t.chart.minX===t.chart.maxX?0:t.chart.minX,t.chart.maxX=Math.abs(t.chart.maxX)>Math.abs(t.chart.minX)?t.chart.maxX:Math.abs(t.chart.minX),t.chart.minX=Math.abs(t.chart.minX)>Math.abs(t.chart.maxX)?t.chart.minX:-1*t.chart.maxX,t.chart.colors=["#f05336","#faa224","#ffd73e","#c6e3bb","#a3d393","#64bc52"],t.chart.color=d3.scale.quantize().domain([t.chart.minX,0,t.chart.maxX]).range(t.chart.colors),t.chart.minX=t.chart.minX>=0?0:t.chart.minX,t.chart.x.domain([t.chart.zeroBased?0:t.chart.minX,t.chart.maxX]).nice()}})},e.prototype.sortData=function(t,e){var a=this.data;a.sort(n(t,e)),this.redraw()},e.prototype.redrawHeader=function(){var t=this.columns(),e=this.selectTable.select("thead").selectAll("tr"),a=e.selectAll("th").data(t);a.enter().append("th").style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),a.text(function(t){return t.title}),a.exit().transition().delay(200).duration(500).style("opacity",0).remove();var n=e.selectAll("th").data(t);n.enter().append("th").style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),n.text(function(t){return t.title}),this.updateColumnStats()},e.prototype.redrawRows=function(){var t=this.data;if(t.length>0){var e=this.selectTable.select("tbody").selectAll("tr").data(t),n=e.selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});n.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),n.call(a),n.exit().transition().delay(200).duration(500).style("opacity",0).remove();var r=e.enter().append("tr").selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});r.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),r.call(a),e.exit().transition().delay(200).duration(500).style("opacity",0).remove()}else alert("Table has no data!")},e.prototype.redraw=function(){this.redrawHeader(),this.redrawRows()},c.table=function(t){return new e(t)},"function"==typeof define&&define.amd?define("d3c",["d3"],function(){return c}):"undefined"!=typeof exports&&"undefined"!=typeof module?module.exports=c:t.d3c=c}(window);