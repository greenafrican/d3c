!function(t){"use strict";function a(t){t=t||{},this.bindto="bindto"in t?t.bindto:"#d3c-table",this.columns("columns"in t?t.columns:[]),this.data="data"in t?t.data:[],this.selectTable=d3.select(this.bindto).append("table"),this.selectTable.append("thead").append("tr"),this.selectTable.append("tbody")}function e(t){t.each(function(t,a){var e=d3.select(this);if("chart"===t.config.type){var n=t.config.chart.x,i=t.config.chart.color,c=t.config.chart.width;e.select("svg").remove();var o=e.append("svg").attr({width:c,height:20});o.append("rect").attr("class",function(t){return"bar bar--"+(t.value<0?"negative":"positive")}).attr("x",function(t){return n(t.config.chart.zeroBased?0:Math.min(0,t.value))}).attr("y",0).attr("rx",3).attr("ry",3).attr("width",function(t){return t.config.chart.zeroBased?Math.abs(n(t.value)):Math.abs(n(t.value)-n(0))}).attr("height",20).attr("fill",function(t){return i(t.value)}),o.append("text").text(function(t){return r(t)}).attr("y",15).attr("x",function(t){var a=t.config.chart.zeroBased?Math.abs(n(t.value)):n(t.value);return t.config.chart.zeroBased?a>c/2?n(0)+Math.abs(n(0))+8:n(0)+Math.abs(n(t.value)-n(0))+5:a<n(0)?a<n(0)/2?a+5:a-40:a>n(0)+(c-n(0))/2?n(0)+Math.abs(n(t.value)-n(0))-40:n(0)+Math.abs(n(t.value)-n(0))}).attr("class",function(t,a){var e=n(t.value);return e<n(0)?e<n(0)/2?"d3c-chart-label-neg-high":"d3c-chart-label-neg-low":e>n(0)+(c-n(0))/2?"d3c-chart-label-pos-high":"d3c-chart-label-pos-low"})}else if("highlight"===t.config.type){e.select("div").remove();var l=t.config.chart.color;e.append("div").style("background-color",function(t){return l(t.value)}).style("text-align","center").text(function(t){return r(t)})}else e.text(function(t){return r(t)})})}function n(t,a){return function(e,n){var r=e.map(function(a,e){return a.key==t?e:void 0}).filter(isFinite),i=n.map(function(a,e){return a.key==t?e:void 0}).filter(isFinite);return"asc"===a?e[r].value>n[i].value:e[r].value<n[i].value}}function r(t){switch(t.config.format){case"text":return t.value;case"number":return d3.format(",0f")(t.value);case"percent":return d3.format(".2%")(t.value);case"currency":return d3.format("$.2f")(t.value);default:return t.value}}var i={version:"0.0.1"};a.prototype.addRow=function(t){var a=[];for(var e in t)a.push({key:e,value:t[e]});t=this.bindColumnConfig(a),this.data.push(t),this.redraw()},a.prototype.columns=function(t){if(0===arguments.length)return this._columns;t||(t={}),this._columns=t;var a=this.data||[];if(0===a.length)return this._columns;for(var e=0;e<a.length;e++)a[e]=this.bindColumnConfig(a[e]);this.data=a,this.redraw()},a.prototype.bindColumnConfig=function(t){var a=this.columns();return t.forEach(function(t){var e=$.grep(a,function(a){return a.key===t.key});t.config=e[0]||{},t.config.match=!$.isEmptyObject(e[0])}),t},a.prototype.updateColumnStats=function(){var t=this.columns(),a=this.data,e=this.selectTable.node().getBoundingClientRect().width;t.forEach(function(t){if("chart"===t.type||"highlight"===t.type){var n=[];a.forEach(function(a){a.forEach(function(a){a.key===t.key&&n.push(a.value)})});var r=parseFloat(t.width)/100;t.chart=t.chart||{},t.chart.zeroBased=t.chart.zeroBased||!1,t.chart.width=Math.floor(e*r),t.chart.x=d3.scale.linear().range([0,t.chart.width]),t.chart.maxX=d3.max(n,function(t){return t}),t.chart.minX=d3.min(n,function(t){return t}),t.chart.minX=t.chart.minX===t.chart.maxX?0:t.chart.minX,t.chart.maxX=Math.abs(t.chart.maxX)>Math.abs(t.chart.minX)?t.chart.maxX:Math.abs(t.chart.minX),t.chart.minX=Math.abs(t.chart.minX)>Math.abs(t.chart.maxX)?t.chart.minX:-1*t.chart.maxX,t.chart.colors=["#f05336","#faa224","#ffd73e","#c6e3bb","#a3d393","#64bc52"],t.chart.color=d3.scale.quantize().domain([t.chart.minX,0,t.chart.maxX]).range(t.chart.colors),t.chart.minX=t.chart.minX>=0?0:t.chart.minX,t.chart.x.domain([t.chart.zeroBased?0:t.chart.minX,t.chart.maxX]).nice()}})},a.prototype.sortData=function(t,a){var e=this.data;e.sort(n(t,a)),this.redraw()},a.prototype.redrawHeader=function(){var t=this.columns(),a=this.selectTable.select("thead").selectAll("tr"),e=a.selectAll("th").data(t);e.enter().append("th").style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),e.text(function(t){return t.title}),e.exit().transition().delay(200).duration(500).style("opacity",0).remove();var n=a.selectAll("th").data(t);n.enter().append("th").style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),n.text(function(t){return t.title}),this.updateColumnStats()},a.prototype.redrawRows=function(){var t=this.data;if(t.length>0){var a=this.selectTable.select("tbody").selectAll("tr").data(t),n=a.selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});n.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),n.call(e),n.exit().transition().delay(200).duration(500).style("opacity",0).remove();var r=a.enter().append("tr").selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});r.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),r.call(e),a.exit().transition().delay(200).duration(500).style("opacity",0).remove()}else alert("Table has no data!")},a.prototype.redraw=function(){this.redrawHeader(),this.redrawRows()},i.table=function(t){return new a(t)},"function"==typeof define&&define.amd?define("d3c",["d3"],function(){return i}):"undefined"!=typeof exports&&"undefined"!=typeof module?module.exports=i:t.d3c=i}(window);