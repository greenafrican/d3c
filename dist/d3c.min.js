!function(t){"use strict";function e(t){switch(t.config.format){case"text":return t.value;case"number":return d3.format(",0f")(t.value);case"percent":return d3.format(".2%")(t.value);case"currency":return d3.format("$.2f")(t.value);default:return t.value}}function r(t){for(var e=d3.values(d3.rgb(t)).slice(0,3),r=0;r<e.length;++r)e[r]=e[r]/255,e[r]<=.03928?e[r]=e[r]/12.92:e[r]=Math.pow((e[r]+.055)/1.055,2.4);var n=.2126*e[0]+.7152*e[1]+.0722*e[2];return n>.5?"black":"white"}function n(t,e,r){for(var n=0;n<t.length;n++)for(var a=0;a<t[n].length;a++)if("key"in t[n][a]&&(console.debug(t[n][a].key,e,t[n][a].key===e),t[n][a].key===e&&"value"in t[n][a]&&(console.debug("match key"),t[n][a].value===r)))return console.debug("match value",n),n;return null}function a(t){t=t||{},this.bindto="bindto"in t?t.bindto:"#d3c-table",this.selectTable=d3.select(this.bindto).append("table"),this.selectTable.append("thead").append("tr"),this.selectTable.append("tbody"),this.data("data"in t?t.data:[]),this.columns("columns"in t?t.columns:[]),this.sort("sort"in t?t.sort:{})}function o(t,e){return function(r,n){var a=r.map(function(e,r){return e.key==t?r:void 0}).filter(isFinite),o=n.map(function(e,r){return e.key==t?r:void 0}).filter(isFinite);return"asc"===e?r[a].value>n[o].value:r[a].value<n[o].value}}function i(t){t.each(function(t,n){var a=d3.select(this);if("chart"===t.config.type){var o=t.config.chart.x,i=(t.config.chart.color,t.config.chart.width);a.select("svg").remove();var c=a.append("svg").attr({width:i,height:20});c.append("rect").attr("class",function(t){return"bar bar--"+(t.value<0?"negative":"positive")}).attr("x",function(t){return o(t.config.chart.zeroBased?0:Math.min(0,t.value))}).attr("y",0).attr("rx",3).attr("ry",3).attr("width",function(t){return t.config.chart.zeroBased?Math.abs(o(t.value)):Math.abs(o(t.value)-o(0))}).attr("height",20).attr("fill",function(t){return t.color}),c.append("text").text(function(t){return e(t)}).attr("y",15).attr("x",function(t){var e=t.config.chart.zeroBased?Math.abs(o(t.value)):o(t.value);return t.config.chart.zeroBased?e>i/2?o(0)+Math.abs(o(0))+8:o(0)+Math.abs(o(t.value)-o(0))+5:e<o(0)?e<o(0)/2?e+5:e-40:e>o(0)+(i-o(0))/2?o(0)+Math.abs(o(t.value)-o(0))-40:o(0)+Math.abs(o(t.value)-o(0))}).attr("class",function(t,e){var r=o(t.value);return r<o(0)?r<o(0)/2?"d3c-chart-label-neg-high":"d3c-chart-label-neg-low":r>o(0)+(i-o(0))/2?"d3c-chart-label-pos-high":"d3c-chart-label-pos-low"}).style("fill",function(t){var e=o(t.value);return e<o(0)?e<o(0)/2?r(t.color):"#000":e>o(0)+(i-o(0))/2?r(t.color):"#000"})}else if("highlight"===t.config.type){a.select("div").remove();var s=t.config.chart.color;a.append("div").style("background-color",function(t){return s(t.value)}).style("text-align","center").text(function(t){return e(t)}).style("color",function(t){return r(d3.select(this).style("background-color"))})}else a.text(function(t){return e(t)})})}var c={version:"0.0.1"};a.prototype.data=function(t){if(0===arguments.length)return this._data||[];this._data=this._data||[];var e=this;t.forEach(function(t){e.addRow(t)}),this.redraw()},a.prototype.addRow=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push({key:r,value:t[r]});this._data.push(e),this.redraw()},a.prototype.updateRow=function(t){var e=this._data,r=n(e,"name",t.name);if(null==r)return void this.addRow(t);var a=[];for(var o in t)t.hasOwnProperty(o)&&a.push({key:o,value:t[o]});e[r]=a,this.redraw()},a.prototype.columns=function(t){return 0===arguments.length?this._columns||[]:(t||(t={}),this._columns=t,void this.redraw())},a.prototype.recalculate=function(){var t=this.columns(),e=this.data(),r="undefined"==typeof this.selectTable.node()?100:this.selectTable.node().getBoundingClientRect().width;t.length>0&&e.length>0&&(t.forEach(function(t,n){if("chart"===t.type||"highlight"===t.type){t.chart=t.chart||{},t.chart.values=[],e.forEach(function(e){e.forEach(function(e){e.key===t.key&&t.chart.values.push(+e.value)})});var a=parseFloat(t.width)/100;t.chart=t.chart||{},t.chart.zeroBased=t.chart.zeroBased||!1,t.chart.width=Math.floor(r*a),t.chart.x=d3.scale.linear().range([0,t.chart.width]),t.chart.maxX=d3.max(t.chart.values,function(t){return+t}),t.chart.minX=d3.min(t.chart.values,function(t){return+t}),t.chart.maxX=t.chart.maxX>Math.abs(t.chart.minX)?t.chart.maxX:Math.abs(t.chart.minX),t.chart.minX=t.chart.minX<-1*t.chart.maxX?t.chart.minX:-1*t.chart.maxX,t.chart.colors=["#f05336","#faa224","#ffd73e","#c6e3bb","#a3d393","#64bc52"],t.chart.color=d3.scale.quantize().domain([t.chart.minX,0,t.chart.maxX]).range(t.chart.colors),t.chart.x.domain([t.chart.zeroBased?0:t.chart.minX,t.chart.maxX]).nice()}}),e.forEach(function(e,r){e.forEach(function(r,n){var a=$.grep(t,function(t){return t.key===r.key});if(r.config=a[0]||{},r.config.match=!$.isEmptyObject(a[0]),"chart"in r.config&&(r.x=r.config.chart.x(r.value)||0,r.color=r.config.chart.color(r.value)||"#000","colorFrom"in r.config.chart)){var o=$.grep(e,function(t){return t.key===r.config.chart.colorFrom});r.color=o[0].color||r.color}})})),this.sort()},a.prototype.sort=function(t){var e=this.data();return e.length<2&&0===arguments.length?this._sort||{}:(0===arguments.length?(t=this._sort||{},"key"in t&&t.key.length&&"direction"in t&&(e.sort(o(t.key,t.direction)),this._data=e)):(this._sort={key:"key"in t?t.key:"",direction:"direction"in t?t.direction:"asc"},this.redraw()),this._sort)},a.prototype.sortColumn=function(t){var e=this,r=t.key||"",n="asc";"_sort"in e&&"key"in e._sort&&e._sort.key===r&&"direction"in e._sort&&(n="asc"===e._sort.direction?"desc":"asc"),this.sort({key:r,direction:n})},a.prototype.redrawHeader=function(){var t=this.columns(),e=this,r=this.selectTable.select("thead").selectAll("tr"),n=r.selectAll("th").data(t);n.enter().append("th").on("click",function(t){e.sortColumn(t),e.redraw()}).style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),n.html(function(t){var r="";return"_sort"in e&&"key"in e._sort&&e._sort.key===t.key&&"direction"in e._sort&&(r="asc"===e._sort.direction?"noticon noticon-uparrow":"noticon noticon-downarrow"),t.title+"<span class='"+r+"'></span>"}),n.exit().transition().delay(200).duration(500).style("opacity",0).remove();var a=r.selectAll("th").data(t);a.enter().append("th").style("width",function(t){return t.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),a.html(function(t){var r="";return"_sort"in e&&"key"in e._sort&&e._sort.key===t.key&&"direction"in e._sort&&(r="asc"===e._sort.direction?"noticon noticon-uparrow":"noticon noticon-downarrow"),t.title+"<span class='"+r+"'></span>"}),this.recalculate()},a.prototype.redrawRows=function(){var t=this.data();if(t.length>0){var e=this.selectTable.select("tbody").selectAll("tr").data(t),r=e.selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});r.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),r.call(i),r.exit().transition().delay(200).duration(500).style("opacity",0).remove();var n=e.enter().append("tr").selectAll("td").data(function(t){return $.grep(t,function(t){return t.config.match})});n.enter().append("td").style("width",function(t){return t.config.width}).style("opacity",0).transition().delay(500).duration(500).style("opacity",1),n.call(i),e.exit().transition().delay(200).duration(500).style("opacity",0).remove()}},a.prototype.redraw=function(){var t=this.columns(),e=this.data();t.length>0&&e.length>0&&(this.recalculate(),this.redrawHeader(),this.redrawRows())},c.table=function(t){return new a(t)},"function"==typeof define&&define.amd?define("d3c",["d3"],function(){return c}):"undefined"!=typeof exports&&"undefined"!=typeof module?module.exports=c:t.d3c=c}(window);